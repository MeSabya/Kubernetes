## Monitoring Logging and Runtime Security with Falco

### Why Falco is needed:
- Falco provides detailed insights into container activities, including process executions, file system changes, network activity, and more.
- Seccomp and AppArmor handle the static policy enforcement, while Falco adds a dynamic, behavioral layer to enhance security and provide real-time threat detection.

### Falco architecture overview 
![image](https://github.com/MeSabya/Kubernetes/assets/33947539/9fd954f1-3d83-4999-97ff-50eac73af64a)

### Commands to check Falco 

![image](https://github.com/MeSabya/Kubernetes/assets/33947539/c0076510-1260-4ef1-a302-0adf3da9942d)

### What does Falco rules file look like:

#### Situation: Detect shell inside a container. It is a security threat if somebody allowed to open a shell inside the container.

![image](https://github.com/MeSabya/Kubernetes/assets/33947539/ffbafa9a-1359-4e1a-841e-2ebf62354af1)


### Falco Configuration files 
Falco is configured using a configuration file, typically named falco.yaml. This file allows you to customize various aspects of Falco's behavior, 
including rules, outputs, and other runtime parameters. Below is an example of a simple Falco configuration file along with explanations for some of the key sections:

```yaml
# falco.yaml

# Configuration for Falco rules
rules_file: /etc/falco/falco_rules.yaml

# Configuration for Falco outputs
json_output: true
file_output:
  enabled: true
  filename: /var/log/falco.log

# Falco outputs to include in alerts
include_output_property:
  source: true
  evt: true

# Configuration for Falco's notification options
notifications:
  enabled: true
  outputs:
    - stdout
    - file
    - syslog
  program_output:
    enabled: false
  priority: DEBUG

# Configuration for Falco's HTTP server
http_server:
  enabled: false
  listen: "0.0.0.0:5060"

# Configuration for Falco's gRPC server
grpc:
  enabled: false
  listen: "0.0.0.0:5060"
  format: string
```

#### Rules Configuration:

- rules_file: Specifies the path to the file containing Falco rules. You can specify a single file or use wildcard patterns to include multiple rule files.

- Outputs Configuration:

json_output: Enables or disables JSON output for Falco alerts.

file_output: Configures file output settings, including whether it's enabled and the file path.

include_output_property: Specifies which properties to include in the output for each alert.

- Notifications Configuration:

notifications: Configures options related to alert notifications.

enabled: Enables or disables alert notifications.

outputs: Specifies the output types for alert notifications (stdout, file, syslog, etc.).

priority: Sets the priority level for notifications.

- HTTP Server Configuration:
  http_server: Configures the HTTP server for Falco. This can be used for external systems to query Falco events through HTTP.

- gRPC Server Configuration:
  grpc: Configures the gRPC server for Falco. This can be used for external systems to query Falco events through gRPC.


### How can you check for the events generated by falco in this set up?
journalctl -u falco

or 

journalctl -uf falco 

The -f flag here keeps the journal logs open for the falco service and you can monitor any new logs that are generated.

### How to update the rule and load the Falco again
Suppose the rule file is: /etc/falco/falco_rules.local.yaml
To update, edit the rule in /etc/falco/falco_rules.local.yaml. Then reload the Falco configuration and restart the engine without restarting the service.
To restart the Falco again:
kill -1 $(cat /var/run/falco.pid)











